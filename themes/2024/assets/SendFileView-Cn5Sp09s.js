import{c as Q,d as $e,r as k,o as Ae,w as Ye,a as y,b as t,e as x,_ as Te,f as le,u as Ze,g as et,h as M,n as l,i as r,j as tt,t as P,k as G,l as K,m as V,p as ee,v as ie,T as ce,F as de,q as ot,s as be,x as ue,y as at,X as we,z as rt,A as st,B as W}from"./index-CW61UiwV.js";import{u as nt,S as ke,C as lt,c as it,a as ct,Q as dt,b as _e,E as ut}from"./clipboard-DBt_4aDj.js";import{F as Me}from"./file-BkZdVsFi.js";import{T as gt}from"./trash-B9XsJPL8.js";/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=Q("ClipboardCopyIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=Q("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=Q("CloudUploadIcon",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=Q("SendIcon",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=Q("TerminalIcon",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]),ht=$e({__name:"BorderProgressBar",props:{progress:{}},setup(L){const D=L,O=k(null),n=k(null);let m=null;const g=()=>{if(!m||!n.value||!O.value)return;const f=O.value.clientWidth,b=O.value.clientHeight;n.value.width=f,n.value.height=b;const d=4,i=8;m.lineWidth=d;const S=m.createLinearGradient(0,0,f,b);S.addColorStop(0,"#4f46e5"),S.addColorStop(.5,"#7c3aed"),S.addColorStop(1,"#db2777"),m.strokeStyle="rgba(229, 231, 235, 0.2)",z(m,d/2,d/2,f-d,b-d,i),m.stroke();const A=((f+b)*2-8*i+2*Math.PI*i)*D.progress/100;m.strokeStyle=S,m.lineCap="round",m.lineJoin="round",m.beginPath();let u=A;const h=d/2,w=f-d,R=b-d;if(u>0){const p=Math.min(w-2*i,u);m.moveTo(i+h,h),m.lineTo(p+i+h,h),u-=p}if(u>0){const p=Math.min(Math.PI/2,u/i);m.arc(w-i+h,i+h,i,-Math.PI/2,p-Math.PI/2,!1),u-=p*i}if(u>0){const p=Math.min(R-2*i,u);m.lineTo(w+h,p+i+h),u-=p}if(u>0){const p=Math.min(Math.PI/2,u/i);m.arc(w-i+h,R-i+h,i,0,p,!1),u-=p*i}if(u>0){const p=Math.min(w-2*i,u);m.lineTo(w-p-i+h,R+h),u-=p}if(u>0){const p=Math.min(Math.PI/2,u/i);m.arc(i+h,R-i+h,i,Math.PI/2,Math.PI/2+p,!1),u-=p*i}if(u>0){const p=Math.min(R-2*i,u);m.lineTo(h,R-p-i+h),u-=p}if(u>0){const p=Math.min(Math.PI/2,u/i);m.arc(i+h,i+h,i,Math.PI,Math.PI+p,!1)}m.stroke()};function z(f,b,d,i,S,$){f.beginPath(),f.moveTo(b+$,d),f.lineTo(b+i-$,d),f.arcTo(b+i,d,b+i,d+$,$),f.lineTo(b+i,d+S-$),f.arcTo(b+i,d+S,b+i-$,d+S,$),f.lineTo(b+$,d+S),f.arcTo(b,d+S,b,d+S-$,$),f.lineTo(b,d+$),f.arcTo(b,d,b+$,d,$),f.closePath()}return Ae(()=>{n.value&&(m=n.value.getContext("2d"),g())}),Ye(()=>D.progress,g),(f,b)=>(x(),y("div",{class:"border-progress-container",ref_key:"container",ref:O},[t("canvas",{ref_key:"canvas",ref:n,class:"border-progress-canvas"},null,512)],512))}}),yt=Te(ht,[["__scopeId","data-v-2fbf5085"]]),Ce=L=>L>=1024*1024*1024?Math.round(L/(1024*1024*1024))+"GB":L>=1024*1024?Math.round(L/(1024*1024))+"MB":Math.round(L/1024)+"KB",xt={class:"p-8"},bt={class:"flex justify-center space-x-2 mb-6"},wt={key:"file",class:"grid grid-cols-1 gap-8"},kt={key:0,class:"absolute inset-0 w-full h-full"},_t={class:"block truncate"},Mt={key:"text",class:"grid grid-cols-1 gap-8"},St={class:"flex flex-col"},Ct={key:"audio",class:"grid grid-cols-1 gap-8"},$t={class:"text-center"},At={key:0,class:"mb-4 p-4 bg-yellow-100 border border-yellow-300 rounded-lg"},Tt=["disabled"],zt={class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pt={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"},It={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z M9 10h6v4H9z"},Dt={class:"text-center mb-4"},Rt={key:0,class:"text-2xl font-mono font-bold text-green-600 mb-2"},Ft={key:0},Bt={key:1},Ut={key:2},jt=["src"],Et={class:"mt-6"},Vt={class:"flex flex-col space-y-3"},Lt={class:"relative flex-grow group"},Nt=["placeholder"],Ht=["value"],Ot=["disabled"],Wt={class:"relative z-10 flex items-center justify-center text-lg"},qt={class:"mt-6 text-center"},Gt={class:"flex-1 overflow-y-auto p-6"},Kt={class:"flex items-start justify-between"},Qt={class:"flex-1 min-w-0"},Jt={class:"flex space-x-2 ml-3"},Xt=["onClick"],Yt=["onClick"],Zt={key:0,class:"text-center py-12"},eo={class:"min-w-0 flex-1"},to={class:"p-4 sm:p-6"},oo={class:"flex items-center mb-3 sm:mb-4"},ao={class:"ml-3 sm:ml-4 min-w-0 flex-1"},ro={class:"grid grid-cols-2 gap-3 sm:gap-4"},so={class:"flex items-center min-w-0"},no={class:"flex items-center min-w-0"},lo={class:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6"},io={class:"space-y-3 sm:space-y-4"},co={class:"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl p-4 sm:p-5 text-white"},uo={class:"flex items-center justify-between mb-3 sm:mb-4"},go={class:"text-2xl sm:text-3xl font-bold tracking-wider text-center break-all"},po={class:"flex items-center justify-between mb-2 sm:mb-3"},vo={class:"bg-white p-3 sm:p-4 rounded-lg shadow-sm mb-3 sm:mb-4"},fo=$e({__name:"SendFileView",setup(L){const D=JSON.parse(localStorage.getItem("config")||"{}"),O=st(),n=tt("isDarkMode"),m=nt(),g=k("file"),z=k(null),f=k(""),b=k(null),d=k("day"),i=k("1"),S=k(0),$=k(!1),A=k(null),u=k(!1),h=k(0),w=k(null),R=k(""),p=k("我的录音"),J=k(""),B=k(null),te=k(0),E=k(null),X=k([]),oe=le(()=>{if(typeof window>"u")return!1;const o=!!(navigator.mediaDevices&&typeof navigator.mediaDevices.getUserMedia=="function"),e=typeof window.MediaRecorder<"u",s=window.isSecureContext||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.protocol==="https:";return o&&e&&s}),ze=()=>{if(d.value==="forever"){const o="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let e="";for(let s=0;s<5;s++)e+=o.charAt(Math.floor(Math.random()*o.length));return e}else return Math.floor(1e4+Math.random()*9e4).toString()},U=k(""),Pe=le(()=>u.value?!1:g.value==="file"?z.value!==null:g.value==="text"?f.value.trim()!=="":g.value==="audio"?w.value!==null:!1),C=Ze(),ge=le(()=>m.shareData),q=k(""),Ie=()=>{const o=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),e=o?["audio/mp4","audio/mp4;codecs=mp4a.40.2","audio/mpeg","audio/mp3","audio/wav","audio/ogg;codecs=opus"]:["audio/mp4","audio/mp4;codecs=mp4a.40.2","audio/mpeg","audio/mp3","audio/wav","audio/ogg;codecs=opus"];console.log(`🎵 检测音频格式支持 (${o?"移动端":"桌面端"}) - 不使用WebM:`);for(const s of e){const a=MediaRecorder.isTypeSupported(s);if(console.log(`${s}: ${a?"✅支持":"❌不支持"}`),a)return console.log(`🎯 选择音频格式: ${s}`),o&&(s.includes("mp4")||s.includes("aac")?console.log("📱 使用移动端优化的AAC格式，确保最佳兼容性和播放支持"):s.includes("mpeg")||s.includes("mp3")?console.log("📱 使用MP3格式，移动端广泛支持且播放兼容性好"):s.includes("wav")&&console.log("📱 使用WAV格式，通用性好但文件较大")),s}return console.log("⚠️ 未找到首选的音频格式"),console.log("🔄 强制使用兼容性最好的格式"),"audio/wav"},De=async()=>{if(!oe.value){C.showAlert("您的浏览器不支持音频录制功能，请使用HTTPS协议或支持的浏览器","error");return}u.value?pe():(w.value&&ve(),await Re())},Re=async()=>{try{if(navigator.permissions)try{if((await navigator.permissions.query({name:"microphone"})).state==="denied"){C.showAlert("麦克风权限被拒绝，请在浏览器设置中允许麦克风访问权限","error");return}}catch{console.log("无法查询权限状态，继续尝试录音")}const o=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:{ideal:44100,min:16e3},channelCount:{ideal:1},sampleSize:{ideal:16}}}),e=Ie(),s=e?{mimeType:e}:{};B.value=new MediaRecorder(o,s),X.value=[],B.value.ondataavailable=a=>{a.data.size>0&&X.value.push(a.data)},B.value.onstop=()=>{let a=e;!a&&B.value&&B.value.mimeType&&(a=B.value.mimeType,console.log("📋 检测到实际录制格式:",a)),a||(a="audio/wav",console.log("⚠️ 无法检测格式，使用WAV作为回退格式")),w.value=new Blob(X.value,{type:a}),R.value=URL.createObjectURL(w.value),J.value=a,Fe(a),o.getTracks().forEach(c=>c.stop()),console.log("🎤 录制完成！"),console.log(`📁 实际录制格式: ${a}`),console.log(`📏 文件大小: ${(w.value.size/1024).toFixed(2)} KB`),console.log(`⏱️ 录制时长: ${h.value} 秒`),console.log(`📝 文件名: ${p.value}`)},B.value.onerror=a=>{console.error("MediaRecorder错误:",a),C.showAlert("录音过程中发生错误","error"),o.getTracks().forEach(c=>c.stop())},B.value.start(1e3),u.value=!0,te.value=Date.now(),E.value=setInterval(()=>{h.value=Math.floor((Date.now()-te.value)/1e3)},1e3)}catch(o){console.error("录音启动失败:",o);let e="录音启动失败";o.name==="NotAllowedError"||o.name==="PermissionDeniedError"?e='麦克风权限被拒绝。请在Chrome浏览器地址栏点击🔒或🎤图标，选择"允许"麦克风访问权限，然后刷新页面重试。':o.name==="NotFoundError"||o.name==="DevicesNotFoundError"?e="未找到麦克风设备，请确保您的设备已连接麦克风并在系统设置中启用":o.name==="NotReadableError"||o.name==="TrackStartError"?e="麦克风被其他应用占用，请关闭其他正在使用麦克风的应用程序，然后重试":o.name==="OverconstrainedError"||o.name==="ConstraintNotSatisfiedError"?e="麦克风不支持所需的录音格式，请尝试使用其他设备":o.name==="SecurityError"?e="安全限制：请确保页面在HTTPS环境下运行":o.name==="AbortError"?e="录音请求被中断，请重试":e=`录音启动失败: ${o.message||"未知错误"}`,C.showAlert(e,"error")}},pe=()=>{B.value&&u.value&&(B.value.stop(),u.value=!1,E.value&&(clearInterval(E.value),E.value=null))},ve=()=>{u.value&&pe(),w.value=null,R.value="",X.value=[],h.value=0,te.value=0,p.value="我的录音",J.value="",E.value&&(clearInterval(E.value),E.value=null)},Fe=o=>{const e=p.value.replace(/\.(mp3|mp4|wav|webm|ogg|m4a|aac)$/i,"");let s=".wav";o.includes("mp4")||o.includes("aac")?s=".m4a":o.includes("mpeg")||o.includes("mp3")?s=".mp3":o.includes("webm")?s=".webm":o.includes("ogg")?s=".ogg":o.includes("wav")&&(s=".wav"),p.value=e+s,console.log(`📝 文件名已更新为: ${p.value} (MIME: ${o})`)},ae=o=>{const e=Math.floor(o/60),s=o%60;return`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`};et(()=>{E.value&&clearInterval(E.value),R.value&&URL.revokeObjectURL(R.value)});const Be=()=>{var o;(o=b.value)==null||o.click()},Ue=async o=>{const e=o.target;if(e.files&&e.files.length>0){const s=e.files[0];if(z.value=s,!se())return;q.value=await re(s),console.log(q.value)}},je=async o=>{var e;if((e=o.dataTransfer)!=null&&e.files&&o.dataTransfer.files.length>0){const s=o.dataTransfer.files[0];if(z.value=s,!se())return;q.value=await re(s)}},Ee=async o=>{var s;const e=(s=o.clipboardData)==null?void 0:s.items;if(e)for(const a of Array.from(e))if(a.kind==="file"){const c=a.getAsFile();if(c){if(c.size===0){C.showAlert("无法读取空文件","error");return}if(z.value=c,!se())return;try{q.value=await re(c),C.showAlert("已从剪贴板添加文件："+c.name,"success")}catch(v){C.showAlert("文件处理失败","error"),console.error("File hash calculation failed:",v)}break}}else g.value="text",e[0].getAsString(c=>{f.value+=c})},re=async o=>new Promise(e=>{const a=new FileReader;let c=0;const v=Math.ceil(o.size/2097152);a.onload=async _=>{const T=new Uint8Array(_.target.result);try{if(window.isSecureContext){const I=await crypto.subtle.digest("SHA-256",T),Y=Array.from(new Uint8Array(I)).map(F=>F.toString(16).padStart(2,"0")).join("");c++,c<v?j():e(Y)}else{const I=fe(o);e(I)}}catch{const H=fe(o);e(H)}};const j=()=>{const _=c*2097152,T=_+2097152>=o.size?o.size:_+2097152;a.readAsArrayBuffer(o.slice(_,T))};j()}),fe=o=>{const e=`${o.name}-${o.size}-${o.lastModified}`;let s=0;for(let a=0;a<e.length;a++){const c=e.charCodeAt(a);s=(s<<5)-s+c,s=s&s}return Math.abs(s).toString(16).padStart(64,"0")},Ve=(o=d.value)=>{switch(o){case"day":return"输入天数";case"hour":return"输入小时数";case"minute":return"输入分钟数";case"count":return"输入查看次数";case"forever":return"永久";default:return"输入值"}},me=(o=d.value)=>{switch(o){case"day":return"天";case"hour":return"小时";case"minute":return"分钟";case"count":return"次";case"forever":return"永久";default:return""}},Le=async o=>{var e,s;try{const c=Math.ceil(o.size/5242880),v=await W.post("chunk/upload/init/",{file_name:o.name,file_size:o.size,chunk_size:5242880,file_hash:q.value});if(v.code!==200)throw new Error("初始化切片上传失败");if(v.detail.existed)return v;const j=v.detail.upload_id;for(let T=0;T<c;T++){const I=T*5242880,H=Math.min(I+5242880,o.size),Y=o.slice(I,H),F=new FormData;if(F.append("chunk",new Blob([Y],{type:o.type})),(await W.post(`chunk/upload/chunk/${j}/${T}`,F,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:Z=>{const ne=Math.round((T*5242880+Z.loaded)*100/o.size);S.value=ne}})).code!==200)throw new Error(`切片 ${T} 上传失败`)}const _=await W.post(`chunk/upload/complete/${j}`,{expire_value:i.value?parseInt(i.value):1,expire_style:d.value,code:U.value});if(_.code!==200)throw new Error("完成上传失败");return _}catch(a){throw console.error("切片上传失败:",a),(s=(e=a.response)==null?void 0:e.data)!=null&&s.detail?C.showAlert(a.response.data.detail,"error"):C.showAlert("上传失败,请稍后重试","error"),a}},Ne=async o=>{const e=new FormData,s={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:c=>{const v=Math.round(c.loaded*100/c.total);S.value=v}};return e.append("file",o),e.append("expire_value",i.value),e.append("expire_style",d.value),e.append("code",U.value),await W.post("share/file/",e,s)},He=async()=>{if(!w.value)throw new Error("音频文件为空");const o=p.value.trim()||"我的录音",e=h.value;try{const s=J.value||w.value.type||"audio/wav";console.log("🔍 上传音频实际格式:",s),console.log("📋 保存的格式:",J.value),console.log("📦 Blob格式:",w.value.type);let a=".wav",c="wav";s.includes("mp4")||s.includes("aac")?(a=".m4a",c="m4a"):s.includes("mpeg")||s.includes("mp3")?(a=".mp3",c="mp3"):s.includes("wav")?(a=".wav",c="wav"):s.includes("ogg")?(a=".ogg",c="ogg"):s.includes("webm")&&(a=".webm",c="webm");const v=o.replace(/\.(mp3|mp4|wav|webm|ogg|m4a|aac)$/i,""),j=v+a;console.log("📤 上传参数:"),console.log(`📁 文件名: ${j}`),console.log(`🎵 格式参数: ${c}`),console.log(`🔖 MIME类型: ${s}`);const _=new FormData;_.append("audio_file",w.value,j),_.append("name",v),_.append("duration",e.toString()),_.append("format",c),_.append("expire_value",i.value),_.append("expire_style",d.value),_.append("code",U.value);const T=await W.post("share/audio/",_,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:I=>{const H=Math.round(I.loaded*100/I.total);S.value=H}});return console.log("✅ 音频上传成功，实际使用格式:",c),T}catch(s){throw console.error("❌ 音频上传失败:",s),s}},Oe=()=>D.openUpload===0&&localStorage.getItem("token")===null?(C.showAlert("游客上传功能已关闭","error"),!1):!0,We=o=>o.size>D.uploadSize?(C.showAlert(`文件大小超过限制 (${Ce(D.uploadSize)})`,"error"),z.value=null,!1):!0,he=(o,e)=>{if(o==="forever"||o==="count")return!0;const s=D.max_save_seconds||0;if(s===0)return!0;let a=0;switch(o){case"minute":a=parseInt(e)*60;break;case"hour":a=parseInt(e)*3600;break;case"day":a=parseInt(e)*86400;break;default:return!1}return a<=s},se=()=>!(!Oe()||g.value==="file"&&z.value&&!We(z.value)||!he(d.value,i.value)),qe=async()=>{var s,a;if(g.value==="file"&&!z.value){C.showAlert("请选择要上传的文件","error");return}if(g.value==="text"&&!f.value.trim()){C.showAlert("请输入要发送的文本","error");return}if(g.value==="audio"&&!w.value){C.showAlert("请先录制音频","error");return}if(d.value!=="forever"&&!i.value){C.showAlert("请输入过期值","error");return}if(!he(d.value,i.value)){const c=Math.floor(D.max_save_seconds/86400);C.showAlert(`过期时间不能超过${c}天`,"error");return}U.value=ze();const o=`${window.location.origin}/#/?code=${U.value}`;console.log(`🎯 提前生成取件码: ${U.value}`),console.log(`🔗 提前生成链接: ${o}`);let e=!1;try{e=await _e(U.value,1),console.log(e?"✅ 提交时立即复制成功":"❌ 提交时立即复制失败，将在后续提供备用方案")}catch(c){console.error("复制链接时发生错误:",c),e=!1}try{let c;if(g.value==="file")D.enableChunk?c=await Le(z.value):c=await Ne(z.value);else if(g.value==="text"){const v=new FormData;v.append("text",f.value),v.append("expire_value",i.value),v.append("expire_style",d.value),v.append("code",U.value),c=await W.post("share/text/",v,{headers:{"Content-Type":"multipart/form-data"}})}else g.value==="audio"&&(c=await He());if(c&&c.code===200){const v=U.value,j=c.detail.name;if(console.log(`📋 ${g.value}上传成功，检查复制状态`),e)console.log("✅ 提交时复制成功，无需额外操作");else{console.log("❌ 提交时复制失败，显示备用方案");const Z=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),ne=/iPhone|iPad|iPod/i.test(navigator.userAgent)&&/CriOS/i.test(navigator.userAgent);(Z||ne)&&console.log("📱 移动端备用方案：显示详细复制信息")}let _="",T="";g.value==="text"?(_=`${(f.value.length/1024).toFixed(2)} KB`,T="📝"):g.value==="audio"?(_=`${((w.value?w.value.size:0)/1024).toFixed(2)} KB`,T="🎵"):(_=`${(z.value.size/(1024*1024)).toFixed(1)} MB`,T="📁");const I={id:Date.now(),filename:`${T} ${j}`,date:new Date().toISOString().split("T")[0],size:_,expiration:d.value==="forever"?"永久":`${i.value}${me()}后过期`,retrieveCode:v};m.addShareData(I);const H=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),Y=/iPhone|iPad|iPod/i.test(navigator.userAgent)&&/CriOS/i.test(navigator.userAgent);let F="",N=4e3;e?g.value==="audio"?(F=`🎵 音频发送成功！时长: ${ae(h.value)}，取件码：${v}
📋 链接已复制到剪贴板`,N=5e3):g.value==="file"?(F=`📁 文件发送成功！取件码：${v}
📋 链接已复制到剪贴板`,N=5e3):g.value==="text"&&(F=`📝 文本发送成功！取件码：${v}
📋 链接已复制到剪贴板`,N=5e3):g.value==="audio"?(F=`🎵 音频发送成功！
⏱️ 时长: ${ae(h.value)}
📋 取件码：${v}
🔗 完整链接：${window.location.origin}/#/?code=${v}
💡 请手动选择并复制上方链接`,N=12e3):g.value==="file"?(F=`📁 文件发送成功！
📋 取件码：${v}
🔗 完整链接：${window.location.origin}/#/?code=${v}
💡 请手动选择并复制上方链接`,N=1e4):g.value==="text"&&(F=`📝 文本发送成功！
📋 取件码：${v}
🔗 完整链接：${window.location.origin}/#/?code=${v}
💡 请手动选择并复制上方链接`,N=1e4),C.showAlert(F,"success",N),A.value=I,z.value=null,f.value="",S.value=0,U.value="",g.value==="audio"&&setTimeout(()=>{ve()},200)}else throw new Error("服务器响应异常")}catch(c){console.error("发送失败:",c),(a=(s=c.response)==null?void 0:s.data)!=null&&a.detail?C.showAlert(c.response.data.detail,"error"):C.showAlert("发送失败,请稍后重试","error")}finally{S.value=0}},Ge=()=>{O.push("/")},ye=()=>{$.value=!$.value},Ke=o=>{A.value=o},Qe=o=>{const e=m.shareData.findIndex(s=>s.id===o);e!==-1&&m.deleteShareData(e)},Je=window.location.origin+"/#/",Xe=o=>`${Je}?code=${o.retrieveCode}`,xe=o=>{const s=(parseInt(i.value)||0)+o;s>=1&&(i.value=s.toString())};return Ae(()=>{console.log("SendFileView mounted")}),(o,e)=>{const s=at("router-link");return x(),y("div",{class:"min-h-screen flex items-center justify-center p-4 overflow-hidden transition-colors duration-300",onPaste:G(Ee,["prevent"])},[t("div",{class:l(["rounded-3xl shadow-2xl overflow-hidden border w-full max-w-md transition-colors duration-300",[r(n)?"bg-white bg-opacity-10 backdrop-filter backdrop-blur-xl border-gray-700":"bg-white border-gray-200"]])},[t("div",xt,[t("h2",{class:l(["text-3xl font-extrabold text-center mb-8 cursor-pointer transition-colors duration-300",[r(n)?"text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 via-purple-300 to-pink-300":"text-indigo-600"]]),onClick:Ge},P(r(D).name),3),t("form",{onSubmit:G(qe,["prevent"]),class:"space-y-8"},[t("div",bt,[t("button",{type:"button",onClick:e[0]||(e[0]=a=>g.value="file"),class:l(["px-3 py-2 rounded-lg text-sm",g.value==="file"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300"])}," 发送文件 ",2),t("button",{type:"button",onClick:e[1]||(e[1]=a=>g.value="text"),class:l(["px-3 py-2 rounded-lg text-sm",g.value==="text"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300"])}," 发送文本 ",2),t("button",{type:"button",onClick:e[2]||(e[2]=a=>g.value="audio"),class:l(["px-3 py-2 rounded-lg text-sm",g.value==="audio"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300"])}," 发送语音 ",2)]),M(ce,{name:"fade",mode:"out-in"},{default:K(()=>[g.value==="file"?(x(),y("div",wt,[t("div",{class:l(["rounded-xl p-8 flex flex-col items-center justify-center border-2 border-dashed transition-all duration-300 group cursor-pointer relative",[r(n)?"bg-gray-800 bg-opacity-50 border-gray-600 hover:border-indigo-500":"bg-gray-100 border-gray-300 hover:border-indigo-500"]]),onClick:Be,onDragover:e[3]||(e[3]=G(()=>{},["prevent"])),onDrop:G(je,["prevent"])},[t("input",{id:"file-upload",type:"file",class:"hidden",onChange:Ue,ref_key:"fileInput",ref:b},null,544),S.value>0?(x(),y("div",kt,[M(yt,{progress:S.value},null,8,["progress"])])):V("",!0),M(r(vt),{class:l(["w-16 h-16 transition-colors duration-300",r(n)?"text-gray-400 group-hover:text-indigo-400":"text-gray-600 group-hover:text-indigo-600"])},null,8,["class"]),t("p",{class:l(["mt-4 text-sm transition-colors duration-300 w-full text-center",r(n)?"text-gray-400 group-hover:text-indigo-400":"text-gray-600 group-hover:text-indigo-600"])},[t("span",_t,P(z.value?z.value.name:"点击或拖放文件到此处上传"),1)],2),t("p",{class:l(["mt-2 text-xs",r(n)?"text-gray-500":"text-gray-400"])}," 支持各种常见格式，最大"+P(r(Ce)(r(D).uploadSize)),3)],34)])):g.value==="text"?(x(),y("div",Mt,[t("div",St,[ee(t("textarea",{id:"text-content","onUpdate:modelValue":e[4]||(e[4]=a=>f.value=a),rows:"7",class:l(["flex-grow px-4 py-3 rounded-xl placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-300 resize-none",r(n)?"bg-gray-800 bg-opacity-50 text-white":"bg-white text-gray-900 border border-gray-300"]),placeholder:"在此输入要发送的文本..."},null,2),[[ie,f.value]])])])):g.value==="audio"?(x(),y("div",Ct,[t("div",$t,[oe.value?V("",!0):(x(),y("div",At,e[15]||(e[15]=[t("p",{class:"text-yellow-800 text-sm"}," ⚠️ 音频录制功能需要在HTTPS环境下运行，或在支持的浏览器中使用。 ",-1)]))),t("button",{type:"button",onClick:De,disabled:!oe.value,class:l(["w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg hover:shadow-xl transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",[u.value?"bg-gradient-to-br from-green-500 to-green-600 animate-pulse":w.value?"bg-gradient-to-br from-orange-500 to-orange-600":"bg-gradient-to-br from-red-500 to-red-600"]])},[(x(),y("svg",zt,[u.value?(x(),y("path",It)):(x(),y("path",Pt))]))],10,Tt),t("div",Dt,[u.value?(x(),y("div",Rt,P(ae(h.value)),1)):V("",!0),t("p",{class:l(["text-sm text-gray-600",[r(n)?"text-gray-400":"text-gray-600"]])},[u.value?(x(),y("span",Ft,"正在录制... 点击停止")):w.value?(x(),y("span",Bt,"录制完成，点击重新录制")):(x(),y("span",Ut,"点击开始录制"))],2)]),w.value?(x(),y("audio",{key:1,src:R.value,controls:"",class:"w-full rounded-lg mb-4"},null,8,jt)):V("",!0),t("div",Et,[t("label",{class:l(["block text-sm font-medium mb-2",r(n)?"text-gray-300":"text-gray-700"])}," 录音文件名 ",2),ee(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>p.value=a),type:"text",placeholder:"我的录音",class:l(["w-full px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-300",r(n)?"bg-gray-800 bg-opacity-50 text-white border border-gray-600":"bg-white text-gray-900 border border-gray-300"])},null,2),[[ie,p.value]])])])])):V("",!0)]),_:1}),t("div",Vt,[t("label",{class:l(["text-sm font-medium",r(n)?"text-gray-300":"text-gray-700"])}," 过期时间 ",2),t("div",Lt,[t("div",{class:l(["relative h-11 rounded-xl border transition-all duration-300",r(n)?"bg-gray-800/50 border-gray-700/50 group-hover:border-gray-600":"bg-white border-gray-200 group-hover:border-gray-300"])},[d.value!=="forever"?(x(),y(de,{key:0},[ee(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>i.value=a),type:"number",placeholder:Ve(),min:"1",class:l(["w-full h-full px-4 pr-32 rounded-xl placeholder-gray-400 transition-all duration-300","focus:outline-none focus:ring-2 focus:ring-offset-0","[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none","bg-transparent",r(n)?"text-gray-100 focus:ring-indigo-500/70 placeholder-gray-500":"text-gray-900 focus:ring-indigo-500/50 placeholder-gray-400"])},null,10,Nt),[[ie,i.value]]),t("div",{class:l(["absolute right-24 top-0 h-full flex flex-col border-l",[r(n)?"border-gray-700/50":"border-gray-200"]])},[t("button",{type:"button",onClick:e[7]||(e[7]=a=>xe(1)),class:l(["flex-1 px-2 flex items-center justify-center transition-all duration-200",[r(n)?"hover:bg-gray-700/50 text-gray-400 hover:text-gray-200":"hover:bg-gray-50 text-gray-500 hover:text-gray-700"]])},e[16]||(e[16]=[t("svg",{class:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"})],-1)]),2),t("button",{type:"button",onClick:e[8]||(e[8]=a=>xe(-1)),class:l(["flex-1 px-2 flex items-center justify-center transition-all duration-200",[r(n)?"hover:bg-gray-700/50 text-gray-400 hover:text-gray-200":"hover:bg-gray-50 text-gray-500 hover:text-gray-700"]])},e[17]||(e[17]=[t("svg",{class:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)]),2)],2)],64)):V("",!0),ee(t("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>d.value=a),class:l(["absolute right-0 top-0 h-full appearance-none cursor-pointer","focus:outline-none focus:ring-2 focus:ring-offset-0",d.value==="forever"?"w-full px-4":"w-24 pl-3 pr-8 border-l",r(n)?"text-gray-100 border-gray-700/50 focus:ring-indigo-500/70 bg-gray-800/50":"text-gray-900 border-gray-200 focus:ring-indigo-500/50 bg-white"])},[(x(!0),y(de,null,be(r(D).expireStyle,a=>(x(),y("option",{value:a,key:a,class:l([r(n)?"bg-gray-800 text-gray-100":"bg-white text-gray-900"])},P(me(a)),11,Ht))),128))],2),[[ot,d.value]]),t("div",{class:l(["absolute pointer-events-none",[d.value==="forever"?"right-3":"right-2","top-1/2 -translate-y-1/2"]])},[(x(),y("svg",{class:l(["w-4 h-4 transition-colors duration-300",[r(n)?"text-gray-400":"text-gray-500"]]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[18]||(e[18]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))],2)],2)])]),t("button",{type:"submit",disabled:!Pe.value,class:"w-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white font-bold py-4 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 transition-all duration-300 transform hover:scale-105 hover:shadow-lg relative overflow-hidden group disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"},[e[20]||(e[20]=t("span",{class:"absolute top-0 left-0 w-full h-full bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"},null,-1)),t("span",Wt,[M(r(ft),{class:"w-6 h-6 mr-2"}),e[19]||(e[19]=t("span",null,"安全寄送",-1))])],8,Ot)],32),t("div",qt,[M(s,{to:"/",class:"text-indigo-400 hover:text-indigo-300 transition duration-300"},{default:K(()=>e[21]||(e[21]=[ue(" 需要取件？点击这里 ",-1)])),_:1,__:[21]})])]),t("div",{class:l(["px-8 py-4 bg-opacity-50 flex justify-between items-center",[r(n)?"bg-gray-800":"bg-gray-100"]])},[t("span",{class:l(["text-sm flex items-center",[r(n)?"text-gray-300":"text-gray-800"]])},[M(r(ke),{class:"w-4 h-4 mr-1 text-green-400"}),e[22]||(e[22]=ue(" 安全加密 ",-1))],2),t("button",{onClick:ye,class:l(["text-sm hover:text-indigo-300 transition duration-300 flex items-center",[r(n)?"text-indigo-400":"text-indigo-600"]])},[e[23]||(e[23]=ue(" 发件记录 ",-1)),M(r(lt),{class:"w-4 h-4 ml-1"})],2)],2)],2),M(ce,{name:"drawer"},{default:K(()=>[$.value?(x(),y("div",{key:0,class:l(["fixed inset-y-0 right-0 w-full sm:w-120 bg-opacity-70 backdrop-filter backdrop-blur-xl shadow-2xl z-50 overflow-hidden flex flex-col",[r(n)?"bg-gray-900":"bg-white"]])},[t("div",{class:l(["flex justify-between items-center p-6 border-b",[r(n)?"border-gray-700":"border-gray-200"]])},[t("h3",{class:l(["text-xl font-semibold",[r(n)?"text-white":"text-gray-900"]])}," 发件记录 ",2),t("button",{onClick:ye,class:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[M(r(we),{class:l(["w-6 h-6",[r(n)?"text-gray-400":"text-gray-500"]])},null,8,["class"])])],2),t("div",Gt,[M(rt,{name:"list",tag:"div",class:"space-y-4"},{default:K(()=>[(x(!0),y(de,null,be(ge.value,a=>(x(),y("div",{key:a.id,class:l(["rounded-xl p-4 border transition-all duration-300 hover:shadow-md",[r(n)?"bg-gray-800 bg-opacity-50 border-gray-700 hover:border-gray-600":"bg-gray-50 border-gray-200 hover:border-gray-300"]])},[t("div",Kt,[t("div",Qt,[t("h4",{class:l(["font-medium text-sm truncate",[r(n)?"text-white":"text-gray-900"]])},P(a.filename),3),t("p",{class:l(["text-xs mt-1 truncate",[r(n)?"text-gray-400":"text-gray-500"]])},P(a.size)+" · "+P(a.date),3),t("p",{class:l(["text-xs mt-1 truncate",[r(n)?"text-gray-400":"text-gray-500"]])},P(a.expiration),3)]),t("div",Jt,[t("button",{onClick:c=>Ke(a),class:"p-1.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[M(r(ut),{class:l(["w-4 h-4",[r(n)?"text-gray-400":"text-gray-500"]])},null,8,["class"])],8,Xt),t("button",{onClick:c=>Qe(a.id),class:"p-1.5 rounded-full hover:bg-red-100 dark:hover:bg-red-900 transition-colors"},[M(r(gt),{class:"w-4 h-4 text-red-500"})],8,Yt)])])],2))),128))]),_:1}),ge.value.length===0?(x(),y("div",Zt,[M(r(Me),{class:l(["w-16 h-16 mx-auto mb-4",[r(n)?"text-gray-600":"text-gray-300"]])},null,8,["class"]),t("p",{class:l([r(n)?"text-gray-400":"text-gray-500"])}," 暂无发件记录 ",2)])):V("",!0)])],2)):V("",!0)]),_:1}),M(ce,{name:"fade"},{default:K(()=>[A.value?(x(),y("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-md flex items-center justify-center z-50 p-4",onClick:e[14]||(e[14]=G(a=>A.value=null,["self"]))},[t("div",{class:l(["w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden transform transition-all duration-300",[r(n)?"bg-gray-900":"bg-white"]])},[t("div",{class:l(["px-4 sm:px-6 py-3 sm:py-4 border-b flex justify-between items-center",[r(n)?"border-gray-800 bg-gray-800":"border-gray-100 bg-gray-50"]])},[t("div",eo,[t("h3",{class:l(["text-base sm:text-lg font-semibold truncate",[r(n)?"text-white":"text-gray-900"]])}," 文件详情 ",2),t("button",{onClick:e[10]||(e[10]=a=>A.value=null),class:"p-1.5 sm:p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[M(r(we),{class:l(["w-4 h-4 sm:w-5 sm:h-5",[r(n)?"text-gray-400":"text-gray-500"]])},null,8,["class"])])])],2),t("div",to,[t("div",{class:l(["rounded-xl p-3 sm:p-4 mb-4 sm:mb-6",[r(n)?"bg-gray-800 bg-opacity-50":"bg-gray-50 bg-opacity-95"]])},[t("div",oo,[t("div",{class:l(["p-2 sm:p-3 rounded-lg",[r(n)?"bg-gray-800":"bg-white"]])},[M(r(Me),{class:l(["w-5 h-5 sm:w-6 sm:h-6",[r(n)?"text-indigo-400":"text-indigo-600"]])},null,8,["class"])],2),t("div",ao,[t("h4",{class:l(["font-medium text-sm sm:text-base truncate",[r(n)?"text-white":"text-gray-900"]])},P(A.value.filename),3),t("p",{class:l(["text-xs sm:text-sm truncate",[r(n)?"text-gray-400":"text-gray-500"]])},P(A.value.size)+" · "+P(A.value.date),3)])]),t("div",ro,[t("div",so,[M(r(pt),{class:l(["w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2 flex-shrink-0",[r(n)?"text-gray-400":"text-gray-500"]])},null,8,["class"]),t("span",{class:l(["text-xs sm:text-sm truncate",[r(n)?"text-gray-300":"text-gray-600"]])},P(A.value.expiration),3)]),t("div",no,[M(r(ke),{class:l(["w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2 flex-shrink-0",[r(n)?"text-gray-400":"text-gray-500"]])},null,8,["class"]),t("span",{class:l(["text-xs sm:text-sm truncate",[r(n)?"text-gray-300":"text-gray-600"]])}," 安全加密 ",2)])])],2),t("div",lo,[t("div",io,[t("div",co,[t("div",uo,[e[24]||(e[24]=t("h4",{class:"font-medium text-sm sm:text-base"},"取件码",-1)),t("button",{onClick:e[11]||(e[11]=a=>r(it)(A.value.retrieveCode)),class:"p-1.5 sm:p-2 rounded-full hover:bg-white/10 transition-colors"},[M(r(Se),{class:"w-4 h-4 sm:w-5 sm:h-5"})])]),t("p",go,P(A.value.retrieveCode),1)]),t("div",{class:l(["rounded-xl p-3 sm:p-4",[r(n)?"bg-gray-800 bg-opacity-50":"bg-gray-50 bg-opacity-95"]])},[t("div",po,[t("h4",{class:l(["font-medium text-sm sm:text-base flex items-center min-w-0",[r(n)?"text-white":"text-gray-900"]])},[M(r(mt),{class:"w-4 h-4 sm:w-5 sm:h-5 mr-1.5 sm:mr-2 text-indigo-500 flex-shrink-0"}),e[25]||(e[25]=t("span",{class:"truncate"},"wget下载",-1))],2),t("button",{onClick:e[12]||(e[12]=a=>r(ct)(A.value.retrieveCode,A.value.filename)),class:"p-1.5 sm:p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex-shrink-0"},[M(r(Se),{class:l(["w-4 h-4 sm:w-5 sm:h-5",[r(n)?"text-gray-400":"text-gray-500"]])},null,8,["class"])])]),t("p",{class:l(["text-xs sm:text-sm font-mono break-all line-clamp-2",[r(n)?"text-gray-300":"text-gray-600"]])}," 点击复制wget命令 ",2)],2)]),t("div",{class:l(["rounded-xl p-4 sm:p-5 flex flex-col items-center",[r(n)?"bg-gray-800 bg-opacity-50":"bg-gray-50 bg-opacity-95"]])},[t("div",vo,[M(dt,{value:Xe(A.value),size:140,level:"M",class:"sm:w-[160px] sm:h-[160px]"},null,8,["value"])]),t("p",{class:l(["text-xs sm:text-sm truncate max-w-full",[r(n)?"text-gray-400":"text-gray-500"]])}," 扫描二维码快速取件 ",2)],2)])]),t("div",{class:l(["px-4 sm:px-6 py-3 sm:py-4 border-t",[r(n)?"border-gray-800":"border-gray-100"]])},[t("button",{onClick:e[13]||(e[13]=a=>r(_e)(A.value.retrieveCode)),class:"w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg text-sm sm:text-base font-medium transition-colors"}," 复制取件链接 ")],2)],2)])):V("",!0)]),_:1})],32)}}}),bo=Te(fo,[["__scopeId","data-v-b9dc00d3"]]);export{bo as default};
