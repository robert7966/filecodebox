import{c as O,d as _e,r as w,o as Me,w as Qe,a as x,b as t,e as b,_ as Se,f as oe,u as Je,g as Xe,h as y,n,i as s,j as Ye,t as I,k as W,l as q,m as U,p as Y,v as ae,T as re,F as se,q as Ze,s as me,x as le,y as et,X as he,z as tt,A as ot,B as N}from"./index-4Kcm6rtJ.js";import{u as at,S as ye,C as rt,c as st,a as lt,Q as nt,b as xe,E as it}from"./clipboard-B7W7IAS8.js";import{F as be}from"./file-BX_vKNnj.js";import{T as ct}from"./trash-DoSOD9Dz.js";/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=O("ClipboardCopyIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=O("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=O("CloudUploadIcon",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=O("SendIcon",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=O("TerminalIcon",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]),vt=_e({__name:"BorderProgressBar",props:{progress:{}},setup(V){const P=V,L=w(null),l=w(null);let f=null;const p=()=>{if(!f||!l.value||!L.value)return;const v=L.value.clientWidth,h=L.value.clientHeight;l.value.width=v,l.value.height=h;const c=4,i=8;f.lineWidth=c;const M=f.createLinearGradient(0,0,v,h);M.addColorStop(0,"#4f46e5"),M.addColorStop(.5,"#7c3aed"),M.addColorStop(1,"#db2777"),f.strokeStyle="rgba(229, 231, 235, 0.2)",T(f,c/2,c/2,v-c,h-c,i),f.stroke();const A=((v+h)*2-8*i+2*Math.PI*i)*P.progress/100;f.strokeStyle=M,f.lineCap="round",f.lineJoin="round",f.beginPath();let g=A;const m=c/2,k=v-c,F=h-c;if(g>0){const d=Math.min(k-2*i,g);f.moveTo(i+m,m),f.lineTo(d+i+m,m),g-=d}if(g>0){const d=Math.min(Math.PI/2,g/i);f.arc(k-i+m,i+m,i,-Math.PI/2,d-Math.PI/2,!1),g-=d*i}if(g>0){const d=Math.min(F-2*i,g);f.lineTo(k+m,d+i+m),g-=d}if(g>0){const d=Math.min(Math.PI/2,g/i);f.arc(k-i+m,F-i+m,i,0,d,!1),g-=d*i}if(g>0){const d=Math.min(k-2*i,g);f.lineTo(k-d-i+m,F+m),g-=d}if(g>0){const d=Math.min(Math.PI/2,g/i);f.arc(i+m,F-i+m,i,Math.PI/2,Math.PI/2+d,!1),g-=d*i}if(g>0){const d=Math.min(F-2*i,g);f.lineTo(m,F-d-i+m),g-=d}if(g>0){const d=Math.min(Math.PI/2,g/i);f.arc(i+m,i+m,i,Math.PI,Math.PI+d,!1)}f.stroke()};function T(v,h,c,i,M,C){v.beginPath(),v.moveTo(h+C,c),v.lineTo(h+i-C,c),v.arcTo(h+i,c,h+i,c+C,C),v.lineTo(h+i,c+M-C),v.arcTo(h+i,c+M,h+i-C,c+M,C),v.lineTo(h+C,c+M),v.arcTo(h,c+M,h,c+M-C,C),v.lineTo(h,c+C),v.arcTo(h,c,h+C,c,C),v.closePath()}return Me(()=>{l.value&&(f=l.value.getContext("2d"),p())}),Qe(()=>P.progress,p),(v,h)=>(b(),x("div",{class:"border-progress-container",ref_key:"container",ref:L},[t("canvas",{ref_key:"canvas",ref:l,class:"border-progress-canvas"},null,512)],512))}}),ft=Se(vt,[["__scopeId","data-v-2fbf5085"]]),ke=V=>V>=1024*1024*1024?Math.round(V/(1024*1024*1024))+"GB":V>=1024*1024?Math.round(V/(1024*1024))+"MB":Math.round(V/1024)+"KB",mt={class:"p-8"},ht={class:"flex justify-center space-x-2 mb-6"},yt={key:"file",class:"grid grid-cols-1 gap-8"},xt={key:0,class:"absolute inset-0 w-full h-full"},bt={class:"block truncate"},wt={key:"text",class:"grid grid-cols-1 gap-8"},kt={class:"flex flex-col"},_t={key:"audio",class:"grid grid-cols-1 gap-8"},Mt={class:"text-center"},St={key:0,class:"mb-4 p-4 bg-yellow-100 border border-yellow-300 rounded-lg"},Ct={key:1,class:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},$t=["disabled"],At={class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Tt={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"},zt={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z M9 10h6v4H9z"},It={class:"text-2xl font-mono font-bold text-gray-900 mb-4"},Dt=["src"],Pt={class:"mt-6"},Ft={key:3,class:"flex gap-3 mt-6"},Rt={class:"flex flex-col space-y-3"},Bt={class:"relative flex-grow group"},Ut=["placeholder"],jt=["value"],Vt=["disabled"],Et={class:"relative z-10 flex items-center justify-center text-lg"},Lt={class:"mt-6 text-center"},Nt={class:"flex-1 overflow-y-auto p-6"},Ht={class:"flex items-start justify-between"},Wt={class:"flex-1 min-w-0"},qt={class:"flex space-x-2 ml-3"},Ot=["onClick"],Gt=["onClick"],Kt={key:0,class:"text-center py-12"},Qt={class:"min-w-0 flex-1"},Jt={class:"p-4 sm:p-6"},Xt={class:"flex items-center mb-3 sm:mb-4"},Yt={class:"ml-3 sm:ml-4 min-w-0 flex-1"},Zt={class:"grid grid-cols-2 gap-3 sm:gap-4"},eo={class:"flex items-center min-w-0"},to={class:"flex items-center min-w-0"},oo={class:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6"},ao={class:"space-y-3 sm:space-y-4"},ro={class:"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl p-4 sm:p-5 text-white"},so={class:"flex items-center justify-between mb-3 sm:mb-4"},lo={class:"text-2xl sm:text-3xl font-bold tracking-wider text-center break-all"},no={class:"flex items-center justify-between mb-2 sm:mb-3"},io={class:"bg-white p-3 sm:p-4 rounded-lg shadow-sm mb-3 sm:mb-4"},co=_e({__name:"SendFileView",setup(V){const P=JSON.parse(localStorage.getItem("config")||"{}"),L=ot(),l=Ye("isDarkMode"),f=at(),p=w("file"),T=w(null),v=w(""),h=w(null),c=w("day"),i=w("1"),M=w(0),C=w(!1),A=w(null),g=w(!1),m=w(0),k=w(null),F=w(""),d=w("我的录音"),G=w(""),B=w(null),Z=w(0),j=w(null),K=w([]),Q=oe(()=>{if(typeof window>"u")return!1;const a=!!(navigator.mediaDevices&&typeof navigator.mediaDevices.getUserMedia=="function"),e=typeof window.MediaRecorder<"u",r=window.isSecureContext||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.protocol==="https:";return a&&e&&r}),Ce=oe(()=>p.value==="file"?T.value!==null:p.value==="text"?v.value.trim()!=="":p.value==="audio"?k.value!==null:!1),_=Je(),ne=oe(()=>f.shareData),H=w(""),$e=()=>{const a=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),e=a?["audio/mp4","audio/mp4;codecs=mp4a.40.2","audio/mpeg","audio/mp3","audio/wav","audio/ogg;codecs=opus"]:["audio/mp4","audio/mp4;codecs=mp4a.40.2","audio/mpeg","audio/mp3","audio/wav","audio/ogg;codecs=opus"];console.log(`🎵 检测音频格式支持 (${a?"移动端":"桌面端"}) - 不使用WebM:`);for(const r of e){const o=MediaRecorder.isTypeSupported(r);if(console.log(`${r}: ${o?"✅支持":"❌不支持"}`),o)return console.log(`🎯 选择音频格式: ${r}`),a&&(r.includes("mp4")||r.includes("aac")?console.log("📱 使用移动端优化的AAC格式，确保最佳兼容性和播放支持"):r.includes("mpeg")||r.includes("mp3")?console.log("📱 使用MP3格式，移动端广泛支持且播放兼容性好"):r.includes("wav")&&console.log("📱 使用WAV格式，通用性好但文件较大")),r}return console.log("⚠️ 未找到首选的音频格式"),console.log("🔄 强制使用兼容性最好的格式"),"audio/wav"},Ae=async()=>{if(!Q.value){_.showAlert("您的浏览器不支持音频录制功能，请使用HTTPS协议或支持的浏览器","error");return}g.value?ie():await Te()},Te=async()=>{try{if(navigator.permissions)try{if((await navigator.permissions.query({name:"microphone"})).state==="denied"){_.showAlert("麦克风权限被拒绝，请在浏览器设置中允许麦克风访问权限","error");return}}catch{console.log("无法查询权限状态，继续尝试录音")}const a=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:{ideal:44100,min:16e3},channelCount:{ideal:1},sampleSize:{ideal:16}}}),e=$e(),r=e?{mimeType:e}:{};B.value=new MediaRecorder(a,r),K.value=[],B.value.ondataavailable=o=>{o.data.size>0&&K.value.push(o.data)},B.value.onstop=()=>{let o=e;o||(B.value&&B.value.mimeType?(o=B.value.mimeType,console.log("📋 检测到实际录制格式:",o),o.includes("webm")&&(console.log("⚠️ 检测到WebM格式，强制使用WAV格式以确保兼容性"),o="audio/wav")):(o="audio/wav",console.log("⚠️ 无法检测格式，使用兼容性最好的WAV格式"))),o&&o.includes("webm")&&(console.log("🔄 将WebM格式转换为WAV格式以确保播放兼容性"),o="audio/wav"),k.value=new Blob(K.value,{type:o}),F.value=URL.createObjectURL(k.value),G.value=o,ze(o),a.getTracks().forEach(u=>u.stop()),console.log("🎤 录制完成！"),console.log(`📁 最终文件格式: ${o}`),console.log(`📏 文件大小: ${(k.value.size/1024).toFixed(2)} KB`),console.log(`⏱️ 录制时长: ${m.value} 秒`),console.log(`📝 文件名: ${d.value}`),o.includes("webm")?(console.error("❌ 错误：最终格式仍包含WebM，这不应该发生！"),_.showAlert("音频格式处理异常，请重新录制","error")):console.log("✅ 验证通过：最终格式不包含WebM")},B.value.onerror=o=>{console.error("MediaRecorder错误:",o),_.showAlert("录音过程中发生错误","error"),a.getTracks().forEach(u=>u.stop())},B.value.start(1e3),g.value=!0,Z.value=Date.now(),j.value=setInterval(()=>{m.value=Math.floor((Date.now()-Z.value)/1e3)},1e3)}catch(a){console.error("录音启动失败:",a);let e="录音启动失败";a.name==="NotAllowedError"||a.name==="PermissionDeniedError"?e='麦克风权限被拒绝。请在Chrome浏览器地址栏点击🔒或🎤图标，选择"允许"麦克风访问权限，然后刷新页面重试。':a.name==="NotFoundError"||a.name==="DevicesNotFoundError"?e="未找到麦克风设备，请确保您的设备已连接麦克风并在系统设置中启用":a.name==="NotReadableError"||a.name==="TrackStartError"?e="麦克风被其他应用占用，请关闭其他正在使用麦克风的应用程序，然后重试":a.name==="OverconstrainedError"||a.name==="ConstraintNotSatisfiedError"?e="麦克风不支持所需的录音格式，请尝试使用其他设备":a.name==="SecurityError"?e="安全限制：请确保页面在HTTPS环境下运行":a.name==="AbortError"?e="录音请求被中断，请重试":e=`录音启动失败: ${a.message||"未知错误"}`,_.showAlert(e,"error")}},ie=()=>{B.value&&g.value&&(B.value.stop(),g.value=!1,j.value&&(clearInterval(j.value),j.value=null))},ce=()=>{g.value&&ie(),k.value=null,F.value="",K.value=[],m.value=0,Z.value=0,d.value="我的录音",G.value="",j.value&&(clearInterval(j.value),j.value=null)},ze=a=>{const e=d.value.replace(/\.(mp3|mp4|wav|webm|ogg|m4a|aac)$/i,"");let r=".wav";a.includes("mp4")||a.includes("aac")?r=".m4a":a.includes("mpeg")||a.includes("mp3")?r=".mp3":a.includes("webm")?(r=".wav",console.log("⚠️ WebM格式文件使用.wav扩展名以确保播放兼容性")):a.includes("ogg")?r=".ogg":a.includes("wav")&&(r=".wav"),d.value=e+r,console.log(`📝 文件名已更新为: ${d.value} (格式: ${a})`),d.value.toLowerCase().includes(".webm")&&(console.error("❌ 错误：文件名仍包含.webm扩展名！"),d.value=e+".wav",console.log("🔄 强制修正为: "+d.value))},ue=a=>{const e=Math.floor(a/60),r=a%60;return`${e.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`};Xe(()=>{j.value&&clearInterval(j.value),F.value&&URL.revokeObjectURL(F.value)});const Ie=()=>{var a;(a=h.value)==null||a.click()},De=async a=>{const e=a.target;if(e.files&&e.files.length>0){const r=e.files[0];if(T.value=r,!te())return;H.value=await ee(r),console.log(H.value)}},Pe=async a=>{var e;if((e=a.dataTransfer)!=null&&e.files&&a.dataTransfer.files.length>0){const r=a.dataTransfer.files[0];if(T.value=r,!te())return;H.value=await ee(r)}},Fe=async a=>{var r;const e=(r=a.clipboardData)==null?void 0:r.items;if(e)for(const o of Array.from(e))if(o.kind==="file"){const u=o.getAsFile();if(u){if(u.size===0){_.showAlert("无法读取空文件","error");return}if(T.value=u,!te())return;try{H.value=await ee(u),_.showAlert("已从剪贴板添加文件："+u.name,"success")}catch($){_.showAlert("文件处理失败","error"),console.error("File hash calculation failed:",$)}break}}else p.value="text",e[0].getAsString(u=>{v.value+=u})},ee=async a=>new Promise(e=>{const o=new FileReader;let u=0;const $=Math.ceil(a.size/2097152);o.onload=async S=>{const z=new Uint8Array(S.target.result);try{if(window.isSecureContext){const R=await crypto.subtle.digest("SHA-256",z),J=Array.from(new Uint8Array(R)).map(X=>X.toString(16).padStart(2,"0")).join("");u++,u<$?D():e(J)}else{const R=de(a);e(R)}}catch{const E=de(a);e(E)}};const D=()=>{const S=u*2097152,z=S+2097152>=a.size?a.size:S+2097152;o.readAsArrayBuffer(a.slice(S,z))};D()}),de=a=>{const e=`${a.name}-${a.size}-${a.lastModified}`;let r=0;for(let o=0;o<e.length;o++){const u=e.charCodeAt(o);r=(r<<5)-r+u,r=r&r}return Math.abs(r).toString(16).padStart(64,"0")},Re=(a=c.value)=>{switch(a){case"day":return"输入天数";case"hour":return"输入小时数";case"minute":return"输入分钟数";case"count":return"输入查看次数";case"forever":return"永久";default:return"输入值"}},ge=(a=c.value)=>{switch(a){case"day":return"天";case"hour":return"小时";case"minute":return"分钟";case"count":return"次";case"forever":return"永久";default:return""}},Be=async a=>{var e,r;try{const u=Math.ceil(a.size/5242880),$=await N.post("chunk/upload/init/",{file_name:a.name,file_size:a.size,chunk_size:5242880,file_hash:H.value});if($.code!==200)throw new Error("初始化切片上传失败");if($.detail.existed)return $;const D=$.detail.upload_id;for(let z=0;z<u;z++){const R=z*5242880,E=Math.min(R+5242880,a.size),J=a.slice(R,E),X=new FormData;if(X.append("chunk",new Blob([J],{type:a.type})),(await N.post(`chunk/upload/chunk/${D}/${z}`,X,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:Ge=>{const Ke=Math.round((z*5242880+Ge.loaded)*100/a.size);M.value=Ke}})).code!==200)throw new Error(`切片 ${z} 上传失败`)}const S=await N.post(`chunk/upload/complete/${D}`,{expire_value:i.value?parseInt(i.value):1,expire_style:c.value});if(S.code!==200)throw new Error("完成上传失败");return S}catch(o){throw console.error("切片上传失败:",o),(r=(e=o.response)==null?void 0:e.data)!=null&&r.detail?_.showAlert(o.response.data.detail,"error"):_.showAlert("上传失败,请稍后重试","error"),o}},Ue=async a=>{const e=new FormData,r={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:u=>{const $=Math.round(u.loaded*100/u.total);M.value=$}};return e.append("file",a),e.append("expire_value",i.value),e.append("expire_style",c.value),await N.post("share/file/",e,r)},je=async()=>{if(!k.value)throw new Error("音频文件为空");const a=d.value.trim()||"我的录音",e=m.value;try{const r=G.value||k.value.type||"audio/wav";console.log("🔍 上传音频实际格式:",r),console.log("📋 保存的格式:",G.value),console.log("📦 Blob格式:",k.value.type);let o=".wav",u="wav";r.includes("mp4")||r.includes("aac")?(o=".m4a",u="m4a"):r.includes("mpeg")||r.includes("mp3")?(o=".mp3",u="mp3"):r.includes("wav")?(o=".wav",u="wav"):r.includes("ogg")?(o=".ogg",u="ogg"):r.includes("webm")&&(o=".wav",u="wav",console.log("⚠️ 检测到WebM格式，上传时使用WAV格式以确保兼容性"));const $=a.replace(/\.(mp3|mp4|wav|webm|ogg|m4a|aac)$/i,""),D=$+o;console.log("📤 上传参数:"),console.log(`📁 文件名: ${D}`),console.log(`🎵 格式参数: ${u}`),console.log(`🔖 MIME类型: ${r}`);const S=new FormData;S.append("audio_file",k.value,D),S.append("name",$),S.append("duration",e.toString()),S.append("format",u),S.append("expire_value",i.value),S.append("expire_style",c.value);const z=await N.post("share/audio/",S,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:R=>{const E=Math.round(R.loaded*100/R.total);M.value=E}});return console.log("✅ 音频上传成功，实际使用格式:",u),z}catch(r){throw console.error("❌ 音频上传失败:",r),r}},Ve=()=>P.openUpload===0&&localStorage.getItem("token")===null?(_.showAlert("游客上传功能已关闭","error"),!1):!0,Ee=a=>a.size>P.uploadSize?(_.showAlert(`文件大小超过限制 (${ke(P.uploadSize)})`,"error"),T.value=null,!1):!0,pe=(a,e)=>{if(a==="forever"||a==="count")return!0;const r=P.max_save_seconds||0;if(r===0)return!0;let o=0;switch(a){case"minute":o=parseInt(e)*60;break;case"hour":o=parseInt(e)*3600;break;case"day":o=parseInt(e)*86400;break;default:return!1}return o<=r},te=()=>!(!Ve()||p.value==="file"&&T.value&&!Ee(T.value)||!pe(c.value,i.value)),Le=async()=>{var a,e;if(p.value==="file"&&!T.value){_.showAlert("请选择要上传的文件","error");return}if(p.value==="text"&&!v.value.trim()){_.showAlert("请输入要发送的文本","error");return}if(p.value==="audio"&&!k.value){_.showAlert("请先录制音频","error");return}if(c.value!=="forever"&&!i.value){_.showAlert("请输入过期值","error");return}if(!pe(c.value,i.value)){const r=Math.floor(P.max_save_seconds/86400);_.showAlert(`过期时间不能超过${r}天`,"error");return}try{let r;if(p.value==="file")P.enableChunk?r=await Be(T.value):r=await Ue(T.value);else if(p.value==="text"){const o=new FormData;o.append("text",v.value),o.append("expire_value",i.value),o.append("expire_style",c.value),r=await N.post("share/text/",o,{headers:{"Content-Type":"multipart/form-data"}})}else p.value==="audio"&&(r=await je());if(r&&r.code===200){const o=r.detail.code,u=r.detail.name;let $="",D="";p.value==="text"?($=`${(v.value.length/1024).toFixed(2)} KB`,D="📝"):p.value==="audio"?($=`${((k.value?k.value.size:0)/1024).toFixed(2)} KB`,D="🎵"):($=`${(T.value.size/(1024*1024)).toFixed(1)} MB`,D="📁");const S={id:Date.now(),filename:`${D} ${u}`,date:new Date().toISOString().split("T")[0],size:$,expiration:c.value==="forever"?"永久":`${i.value}${ge()}后过期`,retrieveCode:o};f.addShareData(S);let z="";p.value==="audio"?z=`音频发送成功！时长: ${ue(m.value)}，取件码：${o}`:z=`${p.value==="file"?"文件":"文本"}发送成功！取件码：${o}`,_.showAlert(z,"success"),A.value=S;const R=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),E=await xe(o);T.value=null,v.value="",M.value=0,p.value==="audio"&&setTimeout(()=>{ce()},100),R&&!E&&setTimeout(()=>{_.showAlert(`📱 移动端提示：
取件码：${o}

💡 您也可以：
1. 点击下方"复制取件链接"按钮
2. 或分享此页面给朋友`,"info",8e3)},2e3)}else throw new Error("服务器响应异常")}catch(r){console.error("发送失败:",r),(e=(a=r.response)==null?void 0:a.data)!=null&&e.detail?_.showAlert(r.response.data.detail,"error"):_.showAlert("发送失败,请稍后重试","error")}finally{M.value=0}},Ne=()=>{L.push("/")},ve=()=>{C.value=!C.value},He=a=>{A.value=a},We=a=>{const e=f.shareData.findIndex(r=>r.id===a);e!==-1&&f.deleteShareData(e)},qe=window.location.origin+"/#/",Oe=a=>`${qe}?code=${a.retrieveCode}`,fe=a=>{const r=(parseInt(i.value)||0)+a;r>=1&&(i.value=r.toString())};return Me(()=>{console.log("SendFileView mounted")}),(a,e)=>{const r=et("router-link");return b(),x("div",{class:"min-h-screen flex items-center justify-center p-4 overflow-hidden transition-colors duration-300",onPaste:W(Fe,["prevent"])},[t("div",{class:n(["rounded-3xl shadow-2xl overflow-hidden border w-full max-w-md transition-colors duration-300",[s(l)?"bg-white bg-opacity-10 backdrop-filter backdrop-blur-xl border-gray-700":"bg-white border-gray-200"]])},[t("div",mt,[t("h2",{class:n(["text-3xl font-extrabold text-center mb-8 cursor-pointer transition-colors duration-300",[s(l)?"text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 via-purple-300 to-pink-300":"text-indigo-600"]]),onClick:Ne},I(s(P).name),3),t("form",{onSubmit:W(Le,["prevent"]),class:"space-y-8"},[t("div",ht,[t("button",{type:"button",onClick:e[0]||(e[0]=o=>p.value="file"),class:n(["px-3 py-2 rounded-lg text-sm",p.value==="file"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300"])}," 发送文件 ",2),t("button",{type:"button",onClick:e[1]||(e[1]=o=>p.value="text"),class:n(["px-3 py-2 rounded-lg text-sm",p.value==="text"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300"])}," 发送文本 ",2),t("button",{type:"button",onClick:e[2]||(e[2]=o=>p.value="audio"),class:n(["px-3 py-2 rounded-lg text-sm",p.value==="audio"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300"])}," 音频录制 ",2)]),y(re,{name:"fade",mode:"out-in"},{default:q(()=>[p.value==="file"?(b(),x("div",yt,[t("div",{class:n(["rounded-xl p-8 flex flex-col items-center justify-center border-2 border-dashed transition-all duration-300 group cursor-pointer relative",[s(l)?"bg-gray-800 bg-opacity-50 border-gray-600 hover:border-indigo-500":"bg-gray-100 border-gray-300 hover:border-indigo-500"]]),onClick:Ie,onDragover:e[3]||(e[3]=W(()=>{},["prevent"])),onDrop:W(Pe,["prevent"])},[t("input",{id:"file-upload",type:"file",class:"hidden",onChange:De,ref_key:"fileInput",ref:h},null,544),M.value>0?(b(),x("div",xt,[y(ft,{progress:M.value},null,8,["progress"])])):U("",!0),y(s(dt),{class:n(["w-16 h-16 transition-colors duration-300",s(l)?"text-gray-400 group-hover:text-indigo-400":"text-gray-600 group-hover:text-indigo-600"])},null,8,["class"]),t("p",{class:n(["mt-4 text-sm transition-colors duration-300 w-full text-center",s(l)?"text-gray-400 group-hover:text-indigo-400":"text-gray-600 group-hover:text-indigo-600"])},[t("span",bt,I(T.value?T.value.name:"点击或拖放文件到此处上传"),1)],2),t("p",{class:n(["mt-2 text-xs",s(l)?"text-gray-500":"text-gray-400"])}," 支持各种常见格式，最大"+I(s(ke)(s(P).uploadSize)),3)],34)])):p.value==="text"?(b(),x("div",wt,[t("div",kt,[Y(t("textarea",{id:"text-content","onUpdate:modelValue":e[4]||(e[4]=o=>v.value=o),rows:"7",class:n(["flex-grow px-4 py-3 rounded-xl placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-300 resize-none",s(l)?"bg-gray-800 bg-opacity-50 text-white":"bg-white text-gray-900 border border-gray-300"]),placeholder:"在此输入要发送的文本..."},null,2),[[ae,v.value]])])])):p.value==="audio"?(b(),x("div",_t,[t("div",Mt,[Q.value?U("",!0):(b(),x("div",St,e[15]||(e[15]=[t("p",{class:"text-yellow-800 text-sm"}," ⚠️ 音频录制功能需要在HTTPS环境下运行，或在支持的浏览器中使用。 ",-1)]))),Q.value?(b(),x("div",Ct,e[16]||(e[16]=[t("div",{class:"text-blue-800 text-sm space-y-2"},[t("p",{class:"font-medium"},"📱 手机录音提示："),t("ul",{class:"list-disc list-inside space-y-1 text-left"},[t("li",null,"确保网站使用HTTPS协议"),t("li",null,"点击录音按钮时允许麦克风权限"),t("li",null,"如果权限被拒绝，点击地址栏的🔒或🎤图标重新授权"),t("li",null,"关闭其他可能占用麦克风的应用")])],-1)]))):U("",!0),t("button",{type:"button",onClick:Ae,disabled:!Q.value,class:n(["w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg hover:shadow-xl transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",[g.value?"bg-gradient-to-br from-green-500 to-green-600 animate-pulse":"bg-gradient-to-br from-red-500 to-red-600"]])},[(b(),x("svg",At,[g.value?(b(),x("path",zt)):(b(),x("path",Tt))]))],10,$t),t("div",It,I(ue(m.value)),1),k.value?(b(),x("audio",{key:2,src:F.value,controls:"",class:"w-full rounded-lg mb-4"},null,8,Dt)):U("",!0),t("div",Pt,[t("label",{class:n(["block text-sm font-medium mb-2",s(l)?"text-gray-300":"text-gray-700"])}," 录音文件名 ",2),Y(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>d.value=o),type:"text",placeholder:"我的录音",class:n(["w-full px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-300",s(l)?"bg-gray-800 bg-opacity-50 text-white border border-gray-600":"bg-white text-gray-900 border border-gray-300"])},null,2),[[ae,d.value]])]),k.value?(b(),x("div",Ft,[t("button",{type:"button",onClick:ce,class:n(["flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",[s(l)?"bg-gray-700 text-gray-300 hover:bg-gray-600":""]])}," 重新录制 ",2)])):U("",!0)])])):U("",!0)]),_:1}),t("div",Rt,[t("label",{class:n(["text-sm font-medium",s(l)?"text-gray-300":"text-gray-700"])}," 过期时间 ",2),t("div",Bt,[t("div",{class:n(["relative h-11 rounded-xl border transition-all duration-300",s(l)?"bg-gray-800/50 border-gray-700/50 group-hover:border-gray-600":"bg-white border-gray-200 group-hover:border-gray-300"])},[c.value!=="forever"?(b(),x(se,{key:0},[Y(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>i.value=o),type:"number",placeholder:Re(),min:"1",class:n(["w-full h-full px-4 pr-32 rounded-xl placeholder-gray-400 transition-all duration-300","focus:outline-none focus:ring-2 focus:ring-offset-0","[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none","bg-transparent",s(l)?"text-gray-100 focus:ring-indigo-500/70 placeholder-gray-500":"text-gray-900 focus:ring-indigo-500/50 placeholder-gray-400"])},null,10,Ut),[[ae,i.value]]),t("div",{class:n(["absolute right-24 top-0 h-full flex flex-col border-l",[s(l)?"border-gray-700/50":"border-gray-200"]])},[t("button",{type:"button",onClick:e[7]||(e[7]=o=>fe(1)),class:n(["flex-1 px-2 flex items-center justify-center transition-all duration-200",[s(l)?"hover:bg-gray-700/50 text-gray-400 hover:text-gray-200":"hover:bg-gray-50 text-gray-500 hover:text-gray-700"]])},e[17]||(e[17]=[t("svg",{class:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"})],-1)]),2),t("button",{type:"button",onClick:e[8]||(e[8]=o=>fe(-1)),class:n(["flex-1 px-2 flex items-center justify-center transition-all duration-200",[s(l)?"hover:bg-gray-700/50 text-gray-400 hover:text-gray-200":"hover:bg-gray-50 text-gray-500 hover:text-gray-700"]])},e[18]||(e[18]=[t("svg",{class:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)]),2)],2)],64)):U("",!0),Y(t("select",{"onUpdate:modelValue":e[9]||(e[9]=o=>c.value=o),class:n(["absolute right-0 top-0 h-full appearance-none cursor-pointer","focus:outline-none focus:ring-2 focus:ring-offset-0",c.value==="forever"?"w-full px-4":"w-24 pl-3 pr-8 border-l",s(l)?"text-gray-100 border-gray-700/50 focus:ring-indigo-500/70 bg-gray-800/50":"text-gray-900 border-gray-200 focus:ring-indigo-500/50 bg-white"])},[(b(!0),x(se,null,me(s(P).expireStyle,o=>(b(),x("option",{value:o,key:o,class:n([s(l)?"bg-gray-800 text-gray-100":"bg-white text-gray-900"])},I(ge(o)),11,jt))),128))],2),[[Ze,c.value]]),t("div",{class:n(["absolute pointer-events-none",[c.value==="forever"?"right-3":"right-2","top-1/2 -translate-y-1/2"]])},[(b(),x("svg",{class:n(["w-4 h-4 transition-colors duration-300",[s(l)?"text-gray-400":"text-gray-500"]]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[19]||(e[19]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))],2)],2)])]),t("button",{type:"submit",disabled:!Ce.value,class:"w-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white font-bold py-4 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 transition-all duration-300 transform hover:scale-105 hover:shadow-lg relative overflow-hidden group disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"},[e[21]||(e[21]=t("span",{class:"absolute top-0 left-0 w-full h-full bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"},null,-1)),t("span",Et,[y(s(gt),{class:"w-6 h-6 mr-2"}),e[20]||(e[20]=t("span",null,"安全寄送",-1))])],8,Vt)],32),t("div",Lt,[y(r,{to:"/",class:"text-indigo-400 hover:text-indigo-300 transition duration-300"},{default:q(()=>e[22]||(e[22]=[le(" 需要取件？点击这里 ",-1)])),_:1,__:[22]})])]),t("div",{class:n(["px-8 py-4 bg-opacity-50 flex justify-between items-center",[s(l)?"bg-gray-800":"bg-gray-100"]])},[t("span",{class:n(["text-sm flex items-center",[s(l)?"text-gray-300":"text-gray-800"]])},[y(s(ye),{class:"w-4 h-4 mr-1 text-green-400"}),e[23]||(e[23]=le(" 安全加密 ",-1))],2),t("button",{onClick:ve,class:n(["text-sm hover:text-indigo-300 transition duration-300 flex items-center",[s(l)?"text-indigo-400":"text-indigo-600"]])},[e[24]||(e[24]=le(" 发件记录 ",-1)),y(s(rt),{class:"w-4 h-4 ml-1"})],2)],2)],2),y(re,{name:"drawer"},{default:q(()=>[C.value?(b(),x("div",{key:0,class:n(["fixed inset-y-0 right-0 w-full sm:w-120 bg-opacity-70 backdrop-filter backdrop-blur-xl shadow-2xl z-50 overflow-hidden flex flex-col",[s(l)?"bg-gray-900":"bg-white"]])},[t("div",{class:n(["flex justify-between items-center p-6 border-b",[s(l)?"border-gray-700":"border-gray-200"]])},[t("h3",{class:n(["text-xl font-semibold",[s(l)?"text-white":"text-gray-900"]])}," 发件记录 ",2),t("button",{onClick:ve,class:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[y(s(he),{class:n(["w-6 h-6",[s(l)?"text-gray-400":"text-gray-500"]])},null,8,["class"])])],2),t("div",Nt,[y(tt,{name:"list",tag:"div",class:"space-y-4"},{default:q(()=>[(b(!0),x(se,null,me(ne.value,o=>(b(),x("div",{key:o.id,class:n(["rounded-xl p-4 border transition-all duration-300 hover:shadow-md",[s(l)?"bg-gray-800 bg-opacity-50 border-gray-700 hover:border-gray-600":"bg-gray-50 border-gray-200 hover:border-gray-300"]])},[t("div",Ht,[t("div",Wt,[t("h4",{class:n(["font-medium text-sm truncate",[s(l)?"text-white":"text-gray-900"]])},I(o.filename),3),t("p",{class:n(["text-xs mt-1 truncate",[s(l)?"text-gray-400":"text-gray-500"]])},I(o.size)+" · "+I(o.date),3),t("p",{class:n(["text-xs mt-1 truncate",[s(l)?"text-gray-400":"text-gray-500"]])},I(o.expiration),3)]),t("div",qt,[t("button",{onClick:u=>He(o),class:"p-1.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[y(s(it),{class:n(["w-4 h-4",[s(l)?"text-gray-400":"text-gray-500"]])},null,8,["class"])],8,Ot),t("button",{onClick:u=>We(o.id),class:"p-1.5 rounded-full hover:bg-red-100 dark:hover:bg-red-900 transition-colors"},[y(s(ct),{class:"w-4 h-4 text-red-500"})],8,Gt)])])],2))),128))]),_:1}),ne.value.length===0?(b(),x("div",Kt,[y(s(be),{class:n(["w-16 h-16 mx-auto mb-4",[s(l)?"text-gray-600":"text-gray-300"]])},null,8,["class"]),t("p",{class:n([s(l)?"text-gray-400":"text-gray-500"])}," 暂无发件记录 ",2)])):U("",!0)])],2)):U("",!0)]),_:1}),y(re,{name:"fade"},{default:q(()=>[A.value?(b(),x("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-md flex items-center justify-center z-50 p-4",onClick:e[14]||(e[14]=W(o=>A.value=null,["self"]))},[t("div",{class:n(["w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden transform transition-all duration-300",[s(l)?"bg-gray-900":"bg-white"]])},[t("div",{class:n(["px-4 sm:px-6 py-3 sm:py-4 border-b flex justify-between items-center",[s(l)?"border-gray-800 bg-gray-800":"border-gray-100 bg-gray-50"]])},[t("div",Qt,[t("h3",{class:n(["text-base sm:text-lg font-semibold truncate",[s(l)?"text-white":"text-gray-900"]])}," 文件详情 ",2),t("button",{onClick:e[10]||(e[10]=o=>A.value=null),class:"p-1.5 sm:p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[y(s(he),{class:n(["w-4 h-4 sm:w-5 sm:h-5",[s(l)?"text-gray-400":"text-gray-500"]])},null,8,["class"])])])],2),t("div",Jt,[t("div",{class:n(["rounded-xl p-3 sm:p-4 mb-4 sm:mb-6",[s(l)?"bg-gray-800 bg-opacity-50":"bg-gray-50 bg-opacity-95"]])},[t("div",Xt,[t("div",{class:n(["p-2 sm:p-3 rounded-lg",[s(l)?"bg-gray-800":"bg-white"]])},[y(s(be),{class:n(["w-5 h-5 sm:w-6 sm:h-6",[s(l)?"text-indigo-400":"text-indigo-600"]])},null,8,["class"])],2),t("div",Yt,[t("h4",{class:n(["font-medium text-sm sm:text-base truncate",[s(l)?"text-white":"text-gray-900"]])},I(A.value.filename),3),t("p",{class:n(["text-xs sm:text-sm truncate",[s(l)?"text-gray-400":"text-gray-500"]])},I(A.value.size)+" · "+I(A.value.date),3)])]),t("div",Zt,[t("div",eo,[y(s(ut),{class:n(["w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2 flex-shrink-0",[s(l)?"text-gray-400":"text-gray-500"]])},null,8,["class"]),t("span",{class:n(["text-xs sm:text-sm truncate",[s(l)?"text-gray-300":"text-gray-600"]])},I(A.value.expiration),3)]),t("div",to,[y(s(ye),{class:n(["w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2 flex-shrink-0",[s(l)?"text-gray-400":"text-gray-500"]])},null,8,["class"]),t("span",{class:n(["text-xs sm:text-sm truncate",[s(l)?"text-gray-300":"text-gray-600"]])}," 安全加密 ",2)])])],2),t("div",oo,[t("div",ao,[t("div",ro,[t("div",so,[e[25]||(e[25]=t("h4",{class:"font-medium text-sm sm:text-base"},"取件码",-1)),t("button",{onClick:e[11]||(e[11]=o=>s(st)(A.value.retrieveCode)),class:"p-1.5 sm:p-2 rounded-full hover:bg-white/10 transition-colors"},[y(s(we),{class:"w-4 h-4 sm:w-5 sm:h-5"})])]),t("p",lo,I(A.value.retrieveCode),1)]),t("div",{class:n(["rounded-xl p-3 sm:p-4",[s(l)?"bg-gray-800 bg-opacity-50":"bg-gray-50 bg-opacity-95"]])},[t("div",no,[t("h4",{class:n(["font-medium text-sm sm:text-base flex items-center min-w-0",[s(l)?"text-white":"text-gray-900"]])},[y(s(pt),{class:"w-4 h-4 sm:w-5 sm:h-5 mr-1.5 sm:mr-2 text-indigo-500 flex-shrink-0"}),e[26]||(e[26]=t("span",{class:"truncate"},"wget下载",-1))],2),t("button",{onClick:e[12]||(e[12]=o=>s(lt)(A.value.retrieveCode,A.value.filename)),class:"p-1.5 sm:p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex-shrink-0"},[y(s(we),{class:n(["w-4 h-4 sm:w-5 sm:h-5",[s(l)?"text-gray-400":"text-gray-500"]])},null,8,["class"])])]),t("p",{class:n(["text-xs sm:text-sm font-mono break-all line-clamp-2",[s(l)?"text-gray-300":"text-gray-600"]])}," 点击复制wget命令 ",2)],2)]),t("div",{class:n(["rounded-xl p-4 sm:p-5 flex flex-col items-center",[s(l)?"bg-gray-800 bg-opacity-50":"bg-gray-50 bg-opacity-95"]])},[t("div",io,[y(nt,{value:Oe(A.value),size:140,level:"M",class:"sm:w-[160px] sm:h-[160px]"},null,8,["value"])]),t("p",{class:n(["text-xs sm:text-sm truncate max-w-full",[s(l)?"text-gray-400":"text-gray-500"]])}," 扫描二维码快速取件 ",2)],2)])]),t("div",{class:n(["px-4 sm:px-6 py-3 sm:py-4 border-t",[s(l)?"border-gray-800":"border-gray-100"]])},[t("button",{onClick:e[13]||(e[13]=o=>s(xe)(A.value.retrieveCode)),class:"w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg text-sm sm:text-base font-medium transition-colors"}," 复制取件链接 ")],2)],2)])):U("",!0)]),_:1})],32)}}}),mo=Se(co,[["__scopeId","data-v-c6c18333"]]);export{mo as default};
